<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Reserva de Espacios Universidad Tecnologica de Nayarit</title>
<style>
  *, *::before, *::after {
    box-sizing: border-box;
  }
  body {
    margin: 0;
    font-family: 'Inter', sans-serif, Arial, sans-serif;
    background: linear-gradient(135deg, #4eaad1, #203a43, #2c5364);
    color: #3482db;
    min-height: 100vh;
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 16px;
  }
  a {
    color: #08697a;
    text-decoration: none;
  }
  a:hover, a:focus {
    text-decoration: underline;
  }

  .container {
    max-width: 1100px;
    width: 100%;
    background: rgba(32, 58, 67, 0.9);
    padding: 24px 32px;
    border-radius: 16px;
    box-shadow: 0 16px 40px rgba(65, 178, 253, 0.25);
    display: flex;
    flex-direction: column;
    gap: 48px;
  }

  header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 32px;
  }

  .logo {
    width: 64px;
    height: 64px;
    flex-shrink: 0;
  }

  .title h1{
    flex-grow: 1;
    text-align: center;
    font-size: 2.4rem;
    font-weight: 800;
    background: linear-gradient(135deg, #20e5ec, #3b82f6);
    -webkit-background: text;
    -webkit-text-fill-color: transparent;
    user-select: none;
  }

  .calendar {
    background: rgba(255 255 255 / 0.05);
    border-radius: 16px;
    padding: 24px 32px;
    user-select: none;
  }

  .calendar-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 16px;
  }

  .calendar-header button {
    background: none;
    border: none;
    color: #06b6d4;
    font-size: 1.5rem;
    cursor: pointer;
    padding: 8px 12px;
    border-radius: 12px;
    transition: background-color 0.25s ease;
  }
  .calendar-header button:hover, .calendar-header button:focus {
    background-color: rgba(6,182,212,0.2);
    outline: none;
  }

  .calendar-month-year {
    font-weight: 700;
    font-size: 1.4rem;
    color: #3b82f6;
    user-select: none;
  }

  .calendar-grid {
    display: grid;
    grid-template-columns: repeat(7, 1fr);
    gap: 12px;
    text-align: center;
  }

  .weekday {
    font-weight: 600;
    text-transform: uppercase;
    font-size: 0.8rem;
    color: #94a3b8;
  }
  .day {
    background: transparent;
    color: #cbd5e1;
    padding: 12px 0;
    border-radius: 12px;
    cursor: pointer;
    position: relative;
    font-weight: 600;
    transition: background-color 0.3s ease, transform 0.2s ease;
    border: none;
  }
  .day:hover, .day:focus {
    background: rgba(6,182,212,0.25);
    outline: none;
    transform: scale(1.05);
  }
  .day.today {
    border: 2px solid #06b6d4;
    color: #06b6d4;
  }
  .day.selected {
    background: #3b82f6;
    color: white;
  }
  .day.disabled {
    color: #475569;
    cursor: default;
  }
  
  .day.has-reservation::after {
    content: "";
    width: 8px;
    height: 8px;
    background: #facc15;
    border-radius: 50%;
    position: absolute;
    bottom: 8px;
    left: 50%;
    transform: translateX(-50%);
  }

  
  .reservations-section {
    background: rgba(255 255 255 / 0.05);
    border-radius: 16px;
    padding: 24px 32px;
  }

  .reservations-section h2 {
    margin-bottom: 24px;
    font-weight: 700;
    font-size: 1.8rem;
    color: #fc8c03;
  }

  .reservation-item {
    background: rgba(0 0 0 / 0.3);
    margin-bottom: 16px;
    padding: 16px 20px;
    border-radius: 12px;
    box-shadow: 0 0 10px rgba(250, 204, 21, 0.2);
    transition: background-color 0.3s ease;
  }
  .reservation-item:last-child {
    margin-bottom: 0;
  }
  .reservation-item strong {
    color: #facc15;
    display: block;
    margin-bottom: 4px;
  }
  .reservation-type {
    font-weight: 700;
    font-size: 0.9rem;
    color: #fc8c03;
    margin-bottom: 8px;
    text-transform: uppercase;
  }

  
  .delete-btn {
    background: #f87171; /* Color rojo */
    color: white;
    border: none;
    border-radius: 8px;
    padding: 8px 12px;
    cursor: pointer;
    margin-top: 8px;
    transition: background-color 0.3s ease;
    font-weight: 700;
    font-size: 0.9rem;
  }

  .delete-btn:hover, .delete-btn:focus {
    background: #dc2626; /* Color rojo más oscuro al pasar el mouse */
    outline: none;
  }

  .reservation-form {
    background: rgba(255 255 255 / 0.05);
    border-radius: 16px;
    padding: 24px 32px;
    display: flex;
    flex-direction: column;
    gap: 32px;
  }

  .reservation-form h2 {
    font-weight: 700;
    font-size: 1.8rem;
    color: #fc8c03;
    margin: 0;
  }

  .toggle-type {
    display: flex;
    gap: 20px;
  }

  .toggle-type label {
    cursor: pointer;
    font-weight: 600;
    padding: 8px 24px;
    border-radius: 12px;
    background: rgba(0, 0, 0, 0.25);
    color: #355177;
    user-select: none;
    flex: 1;
    text-align: center;
    transition: background-color 0.3s ease, color 0.3s ease;
  }

  .toggle-type input[type="radio"] {
    display: none;
  }

  footer{
    
    color: white;
  }

  .toggle-type input[type="radio"]:checked + label {
    background: #3b82f6;
    color: white;
    font-weight: 700;
  }

  form {
    display: grid;
    grid-template-columns: repeat(auto-fill,minmax(280px,1fr));
    gap: 24px;
  }

  label {
    display: flex;
    flex-direction: column;
    font-weight: 600;
    font-size: 0.9rem;
    color: #bcc6d3;
  }
  input, select, textarea {
    margin-top: 8px;
    padding: 12px 16px;
    border-radius: 12px;
    border: none;
    background: rgba(255 255 255 / 0.15);
    color: rgb(15, 14, 14);
    font-size: 1rem;
    transition: background-color 0.3s ease, box-shadow 0.3s ease;
  }
  input:focus, select:focus, textarea:focus {
    outline: none;
    background: rgba(6, 182, 212, 0.2);
    background-color: #5aa8a4;
    box-shadow: 0 0 6px #093841;
  }


  input[type="datetime-local"] {
    font-family: 'Inter', sans-serif;
  }

  /* Igualar el ancho de 'Seleccione un área' y 'Seleccione cuatrimestre' */
  #reservationArea, #semester {
    min-width: auto;
  }
  /* Opcional: si se desea el mismo ancho fijo */
  /* #reservationArea, #semester {
    width: 100%;
    max-width: 300px;
  } */

  .error-message {
    color: #f87171;
    font-size: 0.8rem;
    margin-top: 4px;
    font-weight: 600;
  }

  button.submit-btn {
    grid-column: 1 / -1;
    padding: 16px 32px;
    font-weight: 700;
    font-size: 1.1rem;
    background: linear-gradient(135deg, #06b6d4, #3b82f6);
    border: none;
    border-radius: 12px;
    color: white;
    cursor: pointer;
    transition: background-color 0.3s ease;
  }

  button.submit-btn:hover, button.submit-btn:focus {
    background: #0ea5e9;
    outline: none;
  }

  .confirmation-message {
    background: #16a34a;
    color: white;
    padding: 16px 24px;
    border-radius: 12px;
    text-align: center;
    font-weight: 700;
    font-size: 1rem;
    box-shadow: 0 0 10px #16a34a;
  }

  /* Responsivo */
  @media (max-width: 768px) {
    .container {
      padding: 16px 24px;
    }
    form {
      grid-template-columns: 1fr;
    }
    .toggle-type label {
      padding: 8px 12px;
    }
    header {
      flex-direction: column;
      gap: 12px;
    }
    .title {
      text-align: center;
      user-select: none;
    }
  }
</style>
</head>
<body>
  <main class="container" role="main" aria-label="Sistema de reserva de espacios universitarios">
    <header>
      <img src="https://www.utnay.edu.mx/1assets/img/utn/logout.png" alt="Logotipo de la Universidad" class="logo" width="64" height="64" />
      <h1 class="title" aria-label="Sistema Reserva de Espacios">Sistema Reserva de Espacios</h1>
      <img src="https://utnay.edu.mx/images/ITIIDCIRCULO.png" alt="Logo carrera" class="logo" width="64" height="64" />
    </header>

    <!-- Calendario -->
    <section class="calendar" aria-label="Calendario de reservas">
      <div class="calendar-header">
        <button type="button" aria-label="Mes anterior" id="prevMonthBtn">&#x276E;</button>
        <div class="calendar-month-year" aria-live="polite" aria-atomic="true" id="monthYearLabel">Abril 2024</div>
        <button type="button" aria-label="Mes siguiente" id="nextMonthBtn">&#x276F;</button>
      </div>
      <div role="row" class="calendar-grid" aria-label="Días de la semana">
        <div class="weekday" role="columnheader">Dom</div>
        <div class="weekday" role="columnheader">Lun</div>
        <div class="weekday" role="columnheader">Mar</div>
        <div class="weekday" role="columnheader">Mié</div>
        <div class="weekday" role="columnheader">Jue</div>
        <div class="weekday" role="columnheader">Vie</div>
        <div class="weekday" role="columnheader">Sáb</div>
      </div>
      <div class="calendar-grid" id="calendarDays" role="grid" aria-label="Días del mes" tabindex="0">
        
      </div>
    </section>

    
    <section class="reservations-section" aria-live="polite" aria-atomic="true" aria-label="Reservas para el día seleccionado">
      <h2 id="reservationsTitle">Reservas para el día</h2>
      <div id="reservationsList" tabindex="0">
        
      </div>
    </section>

    <!-- Reservacion -->
    <section class="reservation-form" aria-label="Formulario de reserva de espacios">
      <h2>Solicitar Reserva</h2>
      <div class="toggle-type" role="radiogroup" aria-label="Tipo de usuario para reservar espacio">
        <input type="radio" id="typeStudent" name="userType" value="student" checked />
        <label for="typeStudent" tabindex="0">Alumno</label>
        <input type="radio" id="typeTeacher" name="userType" value="teacher" />
        <label for="typeTeacher" tabindex="0">Profesor</label>
      </div>
      <form id="reservationForm" novalidate>
        <div id="studentFields">
          <label for="studentName">Nombre completo</label>
          <input type="text" id="studentName" name="studentName" autocomplete="name" required aria-required="true" />
          <span class="error-message" id="errorStudentName"></span>

          <label for="matricula">Matrícula</label>
          <input type="text" id="matricula" name="matricula" required aria-required="true" pattern="^[0-9A-Za-z\-]{4,20}$" placeholder="Ejemplo: tic-320126" />
          <span class="error-message" id="errorMatricula"></span>

          <label for="studentCareer">Carrera</label>
          <input type="text" id="studentCareer" name="studentCareer" required aria-required="true" />
          <span class="error-message" id="errorStudentCareer"></span>

          <label for="semester">Cuatrimestre</label>
          <select id="semester" name="semester" required aria-required="true">
            <option value="" disabled selected>Seleccione cuatrimestre</option>
            <option value="1">1°</option>
            <option value="2">2°</option>
            <option value="3">3°</option>
            <option value="4">4°</option>
            <option value="5">5°</option>
            <option value="6">6°</option>
            <option value="7">7°</option>
            <option value="8">8°</option>
          </select>
          <span class="error-message" id="errorSemester"></span>
        </div>

        <div id="teacherFields" style="display:none;">
          <label for="teacherName">Nombre completo</label>
          <input type="text" id="teacherName" name="teacherName" autocomplete="name" />
          <span class="error-message" id="errorTeacherName"></span>

          <label for="employeeNumber">Número de empleado</label>
          <input type="text" id="employeeNumber" name="employeeNumber" pattern="^[0-9]{3,20}$" placeholder="Ejemplo: 15256" />
          <span class="error-message" id="errorEmployeeNumber"></span>

          <label for="teacherCareer">Carrera</label>
          <input type="text" id="teacherCareer" name="teacherCareer" />
          <span class="error-message" id="errorTeacherCareer"></span>
        </div>
        
        <div>
        <label for="reservationArea">Área a reservar</label>
        <select id="reservationArea" name="reservationArea" required aria-required="true">
          <option value="" disabled selected>Seleccione un área</option>
          <option value="Aula 8">Aula 8</option>
          <option value="Aula 9">Aula 9</option>
          <option value="Aula 10">Aula 10</option>
          <option value="Laboratorio 1">Laboratorio 1</option>
          <option value="Laboratorio 7">Laboratorio 7</option>
          <option value="Laboratorio 10">Laboratorio 10</option>
          <option value="Auditorio">Auditorio</option>
        </select>
        <span class="error-message" id="errorReservationArea"></span>
        
        <label for="reservationDateTime">Fecha y hora para reserva</label>
        <input type="datetime-local" id="reservationDateTime" name="reservationDateTime" required aria-required="true" />
        <span class="error-message" id="errorReservationDateTime"></span>
      </div>
        <button type="submit" class="submit-btn" aria-live="polite">Reservar</button>
      </form>
      <div id="confirmationMessage" class="confirmation-message" role="alert" style="display:none; margin-top:16px;"></div>
    </section>
  </main>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      // Initializacion variables
      const calendarDays = document.getElementById('calendarDays');
      const monthYearLabel = document.getElementById('monthYearLabel');
      const prevMonthBtn = document.getElementById('prevMonthBtn');
      const nextMonthBtn = document.getElementById('nextMonthBtn');
      const reservationsList = document.getElementById('reservationsList');
      const reservationsTitle = document.getElementById('reservationsTitle');
      const confirmationMessage = document.getElementById('confirmationMessage');

      
      const typeStudentRadio = document.getElementById('typeStudent');
      const typeTeacherRadio = document.getElementById('typeTeacher');
      const studentFields = document.getElementById('studentFields');
      const teacherFields = document.getElementById('teacherFields');
      const reservationForm = document.getElementById('reservationForm');

      let today = new Date();
      today.setHours(0,0,0,0);
      let currentYear = today.getFullYear();
      let currentMonth = today.getMonth();

      let selectedDate = today;

      function getReservationsFromStorage() {
        const data = localStorage.getItem('universityReservations');
        return data ? JSON.parse(data) : [];
      }

      function saveReservationToStorage(reservation) {
        const all = getReservationsFromStorage();
        all.push(reservation);
        localStorage.setItem('universityReservations', JSON.stringify(all));
      }

      function formatDateKey(date) {
        // formato  YYYY-MM-DD 
        return date.toISOString().split('T')[0];
      }

      function formatDateReadable(date) {
        // formato date dd/mm/yyyy
        return date.toLocaleDateString('es-ES', {day: '2-digit', month: '2-digit', year: 'numeric'});
      }

      function buildCalendar(year, month) {
        calendarDays.innerHTML = '';
        const firstDay = new Date(year, month, 1);
        const lastDay = new Date(year, month + 1, 0);
        const lastDate = lastDay.getDate();
        const firstWeekDay = firstDay.getDay(); 

        monthYearLabel.textContent = firstDay.toLocaleDateString('es-ES', { month: 'long', year: 'numeric' });

        const reservations = getReservationsFromStorage();

        const prevMonthLastDay = new Date(year, month, 0).getDate();

        // Calcular numero de semanas en el mes
        const totalCells = 42; 

        // Crear dias
        for (let i = 0; i < totalCells; i++) {
          const dayCell = document.createElement('button');
          dayCell.type = 'button';
          dayCell.className = 'day';
          dayCell.setAttribute('role', 'gridcell');
          dayCell.tabIndex = -1;

          let dayNumber = 0;
          let dateObj = null;
          
          if (i < firstWeekDay) {
            dayNumber = prevMonthLastDay - firstWeekDay + i +1;
            dayCell.textContent = dayNumber;
            dayCell.classList.add('disabled');
            dayCell.setAttribute('aria-disabled', 'true');
          }
          else if (i >= firstWeekDay && i < firstWeekDay + lastDate) {
            dayNumber = i - firstWeekDay +1;
            dateObj = new Date(year, month, dayNumber);
            dayCell.textContent = dayNumber;
            dayCell.tabIndex = 0;
            dayCell.dataset.date = dateObj.toISOString();
            
            
            if (dateObj.getTime() === today.getTime()) {
              dayCell.classList.add('today');
              dayCell.setAttribute('aria-current', 'date');
            }

            // Marcar si el dia tiene reservacion
            const dateKey = formatDateKey(dateObj);
            const hasReservation = reservations.some(r => r.reservationDateTime.startsWith(dateKey));
            if (hasReservation) {
              dayCell.classList.add('has-reservation');
            }
            
            if (selectedDate.toDateString() === dateObj.toDateString()) {
              dayCell.classList.add('selected');
              dayCell.setAttribute('aria-selected', 'true');
            } else {
              dayCell.setAttribute('aria-selected', 'false');
            }

            // clic dia reservacion
            dayCell.addEventListener('click', () => {
              selectedDate = dateObj;
              buildCalendar(currentYear, currentMonth); 
              displayReservationsForDate(selectedDate);
            });
            dayCell.addEventListener('keydown', (e) => {
              
              const focusableDays = Array.from(calendarDays.querySelectorAll('.day:not(.disabled)'));
              const currentIndex = focusableDays.indexOf(e.target);
              let newIndex = null;
              switch(e.key) {
                case 'ArrowRight':
                  newIndex = (currentIndex + 1) % focusableDays.length;
                  e.preventDefault();
                  focusableDays[newIndex].focus();
                  break;
                case 'ArrowLeft':
                  newIndex = (currentIndex - 1 + focusableDays.length) % focusableDays.length;
                  e.preventDefault();
                  focusableDays[newIndex].focus();
                  break;
                case 'ArrowDown':
                  newIndex = (currentIndex + 7) % focusableDays.length;
                  e.preventDefault();
                  focusableDays[newIndex].focus();
                  break;
                case 'ArrowUp':
                  newIndex = (currentIndex - 7 + focusableDays.length) % focusableDays.length;
                  e.preventDefault();
                  focusableDays[newIndex].focus();
                  break;
                case 'Enter':
                case 'Space':
                  e.preventDefault();
                  e.target.click();
                  break;
              }
            });
          } else {
            // filtro dias
            dayNumber = i - firstWeekDay - lastDate + 1;
            dayCell.textContent = dayNumber;
            dayCell.classList.add('disabled');
            dayCell.setAttribute('aria-disabled', 'true');
          }

          calendarDays.appendChild(dayCell);
        }
      }

      // mostrar reservaciones
      function displayReservationsForDate(date) {
        const dateKey = formatDateKey(date);
        reservationsTitle.textContent = `Reservas para el día ${formatDateReadable(date)}`;
        const allReservations = getReservationsFromStorage();

        const dayReservations = allReservations.filter(r => r.reservationDateTime.startsWith(dateKey));
        reservationsList.innerHTML = '';

        if (dayReservations.length === 0) {
          const noResMsg = document.createElement('p');
          noResMsg.textContent = "No hay reservas para este día.";
          noResMsg.style.fontStyle = 'italic';
          reservationsList.appendChild(noResMsg);
          return;
        }
        dayReservations.sort((a,b) => (a.reservationDateTime > b.reservationDateTime ? 1 : -1));
        dayReservations.forEach(res => {
          const item = document.createElement('article');
          item.className = 'reservation-item';
          item.tabIndex = 0;
          item.setAttribute('aria-label', `Reserva por ${res.userType === 'student' ? 'alumno' : 'profesor'} ${res.name} para área ${res.reservationArea} a las ${new Date(res.reservationDateTime).toLocaleTimeString('es-ES', {hour: '2-digit', minute: '2-digit'})}`);
          const type = document.createElement('div');
          type.className = 'reservation-type';
          type.textContent = res.userType === 'student' ? 'Alumno' : 'Profesor';
          item.appendChild(type);

          const nameLine = document.createElement('strong');
          nameLine.textContent = res.name;
          item.appendChild(nameLine);

          const infoList = document.createElement('ul');
          infoList.style.listStyle = 'none';
          infoList.style.paddingLeft = '0';
          infoList.style.margin = '0';
          infoList.style.color = '#94a3b8';

          if(res.userType === 'student') {
            const liMatricula = document.createElement('li');
            liMatricula.textContent = `Matrícula: ${res.matricula}`;
            infoList.appendChild(liMatricula);
            const liCareer = document.createElement('li');
            liCareer.textContent = `Carrera: ${res.studentCareer}`;
            infoList.appendChild(liCareer);
            const liSemester = document.createElement('li');
            liSemester.textContent = `Cuatrimestre: ${res.semester}`;
            infoList.appendChild(liSemester);
          } else {
            const liEmpNum = document.createElement('li');
            liEmpNum.textContent = `Empleado: ${res.employeeNumber}`;
            infoList.appendChild(liEmpNum);
            const liCareer = document.createElement('li');
            liCareer.textContent = `Carrera: ${res.teacherCareer}`;
            infoList.appendChild(liCareer);
          }
          const liArea = document.createElement('li');
          liArea.textContent = `Área: ${res.reservationArea}`;
          infoList.appendChild(liArea);

          const liDateTime = document.createElement('li');
          const dt = new Date(res.reservationDateTime);
          liDateTime.textContent = `Fecha y Hora: ${formatDateReadable(dt)} ${dt.toLocaleTimeString('es-ES', {hour: '2-digit', minute: '2-digit'})}`;
          infoList.appendChild(liDateTime);

          item.appendChild(infoList);

          // boton eliminar
          const deleteButton = document.createElement('button');
          deleteButton.textContent = 'Eliminar';
          deleteButton.className = 'delete-btn';
          deleteButton.addEventListener('click', () => {
            deleteReservation(res.reservationDateTime, res.userType, res.name);
          });
          item.appendChild(deleteButton);

          reservationsList.appendChild(item);
        });
      }

      // eliminar reservacion
      function deleteReservation(reservationDateTime, userType, name) {
        const allReservations = getReservationsFromStorage();
        const updatedReservations = allReservations.filter(res => {
          return !(res.reservationDateTime === reservationDateTime && res.userType === userType && res.name === name);
        });
        localStorage.setItem('universityReservations', JSON.stringify(updatedReservations));
        displayReservationsForDate(selectedDate); 
        buildCalendar(currentYear, currentMonth); 
      }

      function toggleUserTypeFields() {
        if(typeStudentRadio.checked) {
          studentFields.style.display = 'grid';
          teacherFields.style.display = 'none';
          //Requerimientos reservacion
          document.getElementById('studentName').required = true;
          document.getElementById('matricula').required = true;
          document.getElementById('studentCareer').required = true;
          document.getElementById('semester').required = true;

          document.getElementById('teacherName').required = false;
          document.getElementById('employeeNumber').required = false;
          document.getElementById('teacherCareer').required = false;

        } else {
          studentFields.style.display = 'none';
          teacherFields.style.display = 'grid';

          document.getElementById('teacherName').required = true;
          document.getElementById('employeeNumber').required = true;
          document.getElementById('teacherCareer').required = true;

          document.getElementById('studentName').required = false;
          document.getElementById('matricula').required = false;
          document.getElementById('studentCareer').required = false;
          document.getElementById('semester').required = false;
        }
        clearFormErrors();
        confirmationMessage.style.display = 'none';
      }

      // mensaje error
      function clearFormErrors() {
        const errorIds = [
          'errorStudentName', 'errorMatricula', 'errorStudentCareer', 'errorSemester',
          'errorTeacherName', 'errorEmployeeNumber', 'errorTeacherCareer',
          'errorReservationArea', 'errorReservationDateTime'
        ];
        errorIds.forEach(id => {
          document.getElementById(id).textContent = '';
        });
      }

      // validaciones
      function validateForm() {
        clearFormErrors();
        let valid = true;

        if(typeStudentRadio.checked) {
          const sName = document.getElementById('studentName').value.trim();
          if(sName.length < 3) {
            document.getElementById('errorStudentName').textContent = 'Ingrese un nombre válido.';
            valid = false;
          }
          const matricula = document.getElementById('matricula').value.trim();
          if(!matricula.match(/^[0-9A-Za-z\-]{4,20}$/)) {
            document.getElementById('errorMatricula').textContent = 'Matrícula inválida.';
            valid = false;
          }
          const career = document.getElementById('studentCareer').value.trim();
          if(career.length < 3) {
            document.getElementById('errorStudentCareer').textContent = 'Ingrese una carrera válida.';
            valid = false;
          }
          const semester = document.getElementById('semester').value;
          if(!semester) {
            document.getElementById('errorSemester').textContent = 'Seleccione el cuatrimestre.';
            valid = false;
          }
        } else {
          const tName = document.getElementById('teacherName').value.trim();
          if(tName.length < 3) {
            document.getElementById('errorTeacherName').textContent = 'Ingrese un nombre válido.';
            valid = false;
          }
          const empNum = document.getElementById('employeeNumber').value.trim();
          if(!empNum.match(/^[0-9]{3,20}$/)) {
            document.getElementById('errorEmployeeNumber').textContent = 'Número de empleado inválido.';
            valid = false;
          }
          const tCareer = document.getElementById('teacherCareer').value.trim();
          if(tCareer.length < 3) {
            document.getElementById('errorTeacherCareer').textContent = 'Ingrese una carrera válida.';
            valid = false;
          }
        }

        const area = document.getElementById('reservationArea').value;
        if(!area) {
          document.getElementById('errorReservationArea').textContent = 'Seleccione un área para reservar.';
          valid = false;
        }

        const dateTimeStr = document.getElementById('reservationDateTime').value;
        if(!dateTimeStr) {
          document.getElementById('errorReservationDateTime').textContent = 'Seleccione una fecha y hora válidas.';
          valid = false;
        } else {
          const dateTime = new Date(dateTimeStr);
          if(isNaN(dateTime.getTime())) {
            document.getElementById('errorReservationDateTime').textContent = 'Fecha y hora inválidas.';
            valid = false;
          } else if(dateTime < new Date()) {
            document.getElementById('errorReservationDateTime').textContent = 'La fecha y hora debe ser en el futuro.';
            valid = false;
          }
        }
        return valid;
      }

      reservationForm.addEventListener('submit', (e) => {
        e.preventDefault();
        if(!validateForm()) {
          confirmationMessage.style.display = 'none';
          return;
        }

        const reservationDateTime = document.getElementById('reservationDateTime').value;
        const reservationArea = document.getElementById('reservationArea').value;
        let reservation = {
          userType: typeStudentRadio.checked ? 'student' : 'teacher',
          reservationDateTime,
          reservationArea,
        };

        if (reservation.userType === 'student') {
          reservation.name = document.getElementById('studentName').value.trim();
          reservation.matricula = document.getElementById('matricula').value.trim();
          reservation.studentCareer = document.getElementById('studentCareer').value.trim();
          reservation.semester = document.getElementById('semester').value;
        } else {
          reservation.name = document.getElementById('teacherName').value.trim();
          reservation.employeeNumber = document.getElementById('employeeNumber').value.trim();
          reservation.teacherCareer = document.getElementById('teacherCareer').value.trim();
        }

        // guardar reserva
        saveReservationToStorage(reservation);

        // actualizar calendario
        const selDateKey = formatDateKey(selectedDate);
        const resDateKey = reservationDateTime.split('T')[0];
        if(selDateKey === resDateKey) {
          displayReservationsForDate(selectedDate);
        }
        buildCalendar(currentYear, currentMonth);

        confirmationMessage.textContent = `Reserva creada con éxito para el día ${formatDateReadable(new Date(reservationDateTime))} en el área "${reservationArea}".`;
        confirmationMessage.style.display = 'block';

        // limpiar formulario
        reservationForm.reset();
        typeStudentRadio.checked = true;
        toggleUserTypeFields();
      });

      prevMonthBtn.addEventListener('click', () => {
        currentMonth--;
        if(currentMonth < 0) {
          currentMonth = 11;
          currentYear--;
        }
        buildCalendar(currentYear, currentMonth);
      });
      nextMonthBtn.addEventListener('click', () => {
        currentMonth++;
        if(currentMonth > 11) {
          currentMonth = 0;
          currentYear++;
        }
        buildCalendar(currentYear, currentMonth);
      });

      typeStudentRadio.addEventListener('change', toggleUserTypeFields);
      typeTeacherRadio.addEventListener('change', toggleUserTypeFields);

      buildCalendar(currentYear, currentMonth);
      displayReservationsForDate(selectedDate);
      toggleUserTypeFields();
    });
  </script>
  <footer>  
    &copy; Elaborado por: Gutierrez Ibarra Cesar Manuel, Jimenez Villaseñor Julian, Paez de la Paz Saul Oswaldo, Pineda Sarabia Ian Yael
  </footer>
</body>
</html>